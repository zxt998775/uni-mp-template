{"version":3,"file":"profile.js","sources":["../../../../../src/pagesMember/profile/profile.vue","../../../../../uniPage:/cGFnZXNNZW1iZXJccHJvZmlsZVxwcm9maWxlLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\nimport { codeToText } from '@/utils/element-china-area-data.mjs'\nimport { getMemberProfileAPI, putMemberProfileAPI } from '@/api/login'\nimport { useMemberStore } from '@/stores'\n// 获取屏幕边界到安全区域距离\nconst { safeAreaInsets } = uni.getSystemInfoSync()\n// 完整地区\nconst fullLocation = ref<string>('')\n// 获取个人信息，修改个人信息需提供初始值\nconst profile = ref({} as ProfileDetail)\nconst getMemberProfileData = async () => {\n  const res = await getMemberProfileAPI()\n  profile.value = res.result\n  console.log(profile.value)\n  if (profile.value.provinceCode && profile.value.cityCode && profile.value.countyCode) {\n    fullLocation.value =\n      codeToText[profile.value.provinceCode?.replace(/0+$/, '')] +\n      ' ' +\n      codeToText[profile.value.cityCode?.replace(/0+$/, '')] +\n      ' ' +\n      codeToText[profile.value.countyCode?.replace(/0+$/, '')]\n  }\n  profile.value.birthday = profile.value.birthday?.split('T')[0]\n  // codeToText[地区码] 匹配地区名称，但是 element-china-area-data 里的code去掉了末尾的0，所以去要使用正则表达式替换\n  // profile.value.fullLocation = fullLocation.value\n}\nonLoad(() => {\n  getMemberProfileData()\n})\nconst memberStore = useMemberStore()\n\n// 修改头像\nconst onAvatarChange = () => {\n  // 调⽤拍照/选择图⽚\n  uni.chooseMedia({\n    // ⽂件个数\n    count: 1,\n    // ⽂件类型\n    mediaType: ['image'],\n    success: (res) => {\n      // 本地路径\n      const { tempFilePath } = res.tempFiles[0]\n      // ⽂件上传\n      uni.uploadFile({\n        url: '/user/profile/avatar',\n        name: 'file', // 后端数据字段名\n        filePath: tempFilePath, // 新头像\n        success: (res) => {\n          // 判断状态码是否上传成功\n          if (res.statusCode === 200) {\n            // 提取头像\n            const avatar = JSON.parse(res.data).result\n            // 当前⻚⾯更新头像\n            profile.value!.avatar = avatar\n            // 更新 Store 头像\n            memberStore.profile!.avatar = avatar\n            uni.showToast({ icon: 'success', title: '更新成功' })\n          } else {\n            uni.showToast({ icon: 'error', title: '出现错误' })\n          }\n        }\n      })\n    }\n  })\n}\n\n// 获取个⼈信息，修改个⼈信息需提供初始值\n\n// 修改性别\nconst onGenderChange: UniHelper.RadioGroupOnChange = (ev) => {\n  profile.value.gender = parseInt(ev.detail.value) as Gender\n}\n\n// 修改⽣⽇\nconst onBirthdayChange: UniHelper.DatePickerOnChange = (ev) => {\n  profile.value.birthday = ev.detail.value\n}\n// 修改城市\nlet fullLocationCode: [string, string, string] = ['', '', '']\nconst onFullLocationChange: UniHelper.RegionPickerOnChange = (ev) => {\n  // 修改前端界⾯\n  fullLocation.value = ev.detail.value.join(' ')\n  // 提交后端更新\n  fullLocationCode = ev.detail.code!\n}\n\n// 点击保存提交表单\nconst onSubmit = async () => {\n  const { nickname, gender, birthday, profession } = profile.value\n  console.log(fullLocationCode)\n  console.log(birthday)\n  const res = await putMemberProfileAPI({\n    nickname,\n    gender,\n    birthday,\n    profession,\n    provinceCode: fullLocationCode[0],\n    cityCode: fullLocationCode[1],\n    countyCode: fullLocationCode[2]\n  })\n  // 更新Store昵称\n  memberStore.profile!.nickname = res.result.nickname\n  uni.showToast({ icon: 'success', title: '保存成功' })\n  setTimeout(() => {\n    uni.navigateBack()\n  }, 400)\n}\n</script>\n<template>\n  <view class=\"viewport\">\n    <!-- 导航栏 -->\n    <view class=\"navbar\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\n      <navigator open-type=\"navigateBack\" class=\"back icon-left\" hover-cla ss=\"none\"></navigator>\n      <view class=\"title\">个⼈信息</view>\n    </view>\n    <!-- 头像 -->\n    <view class=\"avatar\">\n      <view class=\"avatar-content\">\n        <image @tap=\"onAvatarChange\" class=\"image\" :src=\"profile?.avatar\" mode=\"aspectFill\" />\n        <text class=\"text\">点击修改头像</text>\n      </view>\n    </view>\n    <!-- 表单 -->\n    <view class=\"form\">\n      <!-- 表单内容 -->\n      <view class=\"form-content\">\n        <view class=\"form-item\">\n          <text class=\"label\">账号</text>\n          <text class=\"account\">{{ profile.account }}</text>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">昵称</text>\n          <input class=\"input\" type=\"text\" placeholder=\"请填写昵称\" v-model=\"profile.nickname\" />\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">性别</text>\n          <radio-group @change=\"onGenderChange\">\n            <label class=\"radio\">\n              <radio value=\"0\" color=\"#27ba9b\" :checked=\"profile?.gender === 0\" />\n              男\n            </label>\n            <label class=\"radio\">\n              <radio value=\"1\" color=\"#27ba9b\" :checked=\"profile?.gender === 1\" />\n              ⼥\n            </label>\n          </radio-group>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">⽣⽇</text>\n          <picker\n            class=\"picker\"\n            mode=\"date\"\n            start=\"1900-01-01\"\n            :end=\"new Date()\"\n            :value=\"profile.birthday\"\n            @change=\"onBirthdayChange\"\n          >\n            <view v-if=\"profile.birthday\">{{ profile.birthday }}</view>\n            <view class=\"placeholder\" v-else>请选择⽇期</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">城市</text>\n          <picker\n            class=\"picker\"\n            mode=\"region\"\n            :value=\"fullLocation?.split(' ')\"\n            @change=\"onFullLocationChange\"\n          >\n            <view v-if=\"fullLocation\">{{ fullLocation }}</view>\n            <view class=\"placeholder\" v-else>请选择城市</view>\n          </picker>\n        </view>\n        <view class=\"form-item\">\n          <text class=\"label\">职业</text>\n          <input class=\"input\" type=\"text\" placeholder=\"请填写职业\" v-model=\"profile.profession\" />\n        </view>\n      </view>\n      <!-- 提交按钮 -->\n      <button @tap=\"onSubmit\" class=\"form-button\">保 存</button>\n    </view>\n  </view>\n</template>\n\n<style lang=\"scss\">\npage {\n  background-color: #f4f4f4;\n}\n\n.viewport {\n  display: flex;\n  flex-direction: column;\n  height: 100%;\n  background-image: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/order_bg.png);\n  background-size: auto 420rpx;\n  background-repeat: no-repeat;\n}\n\n// 导航栏\n.navbar {\n  position: relative;\n\n  .title {\n    height: 40px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 16px;\n    font-weight: 500;\n    color: #fff;\n  }\n\n  .back {\n    position: absolute;\n    height: 40px;\n    width: 40px;\n    left: 0;\n    font-size: 20px;\n    color: #fff;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n}\n\n// 头 像\n.avatar {\n  text-align: center;\n  width: 100%;\n  height: 260rpx;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n\n  .image {\n    width: 160rpx;\n    height: 160rpx;\n    border-radius: 50%;\n    background-color: #eee;\n  }\n\n  .text {\n    display: block;\n    padding-top: 20rpx;\n    line-height: 1;\n    font-size: 26rpx;\n    color: #fff;\n  }\n}\n\n// 表 单\n.form {\n  background-color: #f4f4f4;\n\n  &-content {\n    margin: 20rpx 20rpx 0;\n    padding: 0 20rpx;\n    border-radius: 10rpx;\n    background-color: #fff;\n  }\n\n  &-item {\n    display: flex;\n    height: 96rpx;\n    line-height: 46rpx;\n    padding: 25rpx 10rpx;\n    background-color: #fff;\n    font-size: 28rpx;\n    border-bottom: 1rpx solid #ddd;\n\n    &:last-child {\n      border: none;\n    }\n\n    .label {\n      width: 180rpx;\n      color: #333;\n    }\n\n    .account {\n      color: #666;\n    }\n\n    .input {\n      flex: 1;\n      display: block;\n      height: 46rpx;\n    }\n\n    .radio {\n      margin-right: 20rpx;\n    }\n\n    .picker {\n      flex: 1;\n    }\n\n    .placeholder {\n      color: #808080;\n    }\n  }\n\n  &-button {\n    height: 80rpx;\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/应用开发/前端/shop-online/uni-mp-template-own/src/pagesMember/profile/profile.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","getMemberProfileAPI","codeToText","onLoad","useMemberStore","res","putMemberProfileAPI"],"mappings":";;;;;;;;;;AAKA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAE3C,UAAA,eAAeC,kBAAY,EAAE;AAE7B,UAAA,UAAUA,kBAAI,CAAA,CAAmB;AACvC,UAAM,uBAAuB,YAAY;;AACjC,YAAA,MAAM,MAAMC,UAAAA;AAClB,cAAQ,QAAQ,IAAI;AACZ,cAAA,IAAI,QAAQ,KAAK;AACrB,UAAA,QAAQ,MAAM,gBAAgB,QAAQ,MAAM,YAAY,QAAQ,MAAM,YAAY;AACpF,qBAAa,QACXC,2BAAAA,GAAW,aAAQ,MAAM,iBAAd,mBAA4B,QAAQ,OAAO,GAAG,IACzD,MACAA,2BAAAA,GAAW,aAAQ,MAAM,aAAd,mBAAwB,QAAQ,OAAO,GAAG,IACrD,MACAA,2BAAA,GAAW,aAAQ,MAAM,eAAd,mBAA0B,QAAQ,OAAO,GAAG;AAAA,MAC3D;AACQ,cAAA,MAAM,YAAW,aAAQ,MAAM,aAAd,mBAAwB,MAAM,KAAK;AAAA,IAAC;AAI/DC,kBAAAA,OAAO,MAAM;AACU;IAAA,CACtB;AACD,UAAM,cAAcC,sBAAAA;AAGpB,UAAM,iBAAiB,MAAM;AAE3BL,oBAAAA,MAAI,YAAY;AAAA;AAAA,QAEd,OAAO;AAAA;AAAA,QAEP,WAAW,CAAC,OAAO;AAAA,QACnB,SAAS,CAAC,QAAQ;AAEhB,gBAAM,EAAE,aAAiB,IAAA,IAAI,UAAU,CAAC;AAExCA,wBAAAA,MAAI,WAAW;AAAA,YACb,KAAK;AAAA,YACL,MAAM;AAAA;AAAA,YACN,UAAU;AAAA;AAAA,YACV,SAAS,CAACM,SAAQ;AAEZA,kBAAAA,KAAI,eAAe,KAAK;AAE1B,sBAAM,SAAS,KAAK,MAAMA,KAAI,IAAI,EAAE;AAEpC,wBAAQ,MAAO,SAAS;AAExB,4BAAY,QAAS,SAAS;AAC9BN,8BAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AAAA,cAAA,OAC3C;AACLA,8BAAA,MAAI,UAAU,EAAE,MAAM,SAAS,OAAO,QAAQ;AAAA,cAChD;AAAA,YACF;AAAA,UAAA,CACD;AAAA,QACH;AAAA,MAAA,CACD;AAAA,IAAA;AAMG,UAAA,iBAA+C,CAAC,OAAO;AAC3D,cAAQ,MAAM,SAAS,SAAS,GAAG,OAAO,KAAK;AAAA,IAAA;AAI3C,UAAA,mBAAiD,CAAC,OAAO;AACrD,cAAA,MAAM,WAAW,GAAG,OAAO;AAAA,IAAA;AAGrC,QAAI,mBAA6C,CAAC,IAAI,IAAI,EAAE;AACtD,UAAA,uBAAuD,CAAC,OAAO;AAEnE,mBAAa,QAAQ,GAAG,OAAO,MAAM,KAAK,GAAG;AAE7C,yBAAmB,GAAG,OAAO;AAAA,IAAA;AAI/B,UAAM,WAAW,YAAY;AAC3B,YAAM,EAAE,UAAU,QAAQ,UAAU,eAAe,QAAQ;AAC3D,cAAQ,IAAI,gBAAgB;AAC5B,cAAQ,IAAI,QAAQ;AACd,YAAA,MAAM,MAAMO,8BAAoB;AAAA,QACpC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA,cAAc,iBAAiB,CAAC;AAAA,QAChC,UAAU,iBAAiB,CAAC;AAAA,QAC5B,YAAY,iBAAiB,CAAC;AAAA,MAAA,CAC/B;AAEW,kBAAA,QAAS,WAAW,IAAI,OAAO;AAC3CP,oBAAA,MAAI,UAAU,EAAE,MAAM,WAAW,OAAO,QAAQ;AAChD,iBAAW,MAAM;AACfA,sBAAA,MAAI,aAAa;AAAA,SAChB,GAAG;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxGR,GAAG,WAAW,eAAe;"}